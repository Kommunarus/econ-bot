from bot_v4.agent import create_my_agent
from bot_v4.metrics import print_snapshot
import time

def demo():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã"""

    print("=== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã ===")
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∫—ç—à–µ–π, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞

    test_queries = [
        "–†–∞—Å—Å–∫–∞–∂–∏ –æ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏",
        "–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –õ–æ–Ω–¥–æ–Ω–µ?",
        "–ì–¥–µ –∑–∞–∫–∞–∑ Order-345876?",
        "–ü–æ—Å—á–∏—Ç–∞–π 20% –æ—Ç 7500",
        "100 EUR –≤ —Ä—É–±–ª—è—Ö",
        "–°—Ä–∞–≤–Ω–∏ –≤–∞—à–∏ —Ü–µ–Ω—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏",  # —Å–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    ]
    agent = create_my_agent()
    for query in test_queries:
        print(f"\n{'=' * 60}")
        print(f"–ó–∞–ø—Ä–æ—Å: {query}")
        print(f"{'=' * 60}")
        msg = query.lower().strip()
        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
        start = time.time()
        result = agent.invoke({"messages": [{"role": "user", "content": msg}, ]},
                              {"recursion_limit": 21})
        end = time.time()
        print(result["messages"][-1].content)
        # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        print("–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ–∫: ",round(end - start, 1))
        # –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ª–∏ –∫—ç—à

    print("\n=== –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ===")
    print_snapshot()

if __name__ == "__main__":
    demo()


    """=== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã ===
    
    ============================================================
    –ó–∞–ø—Ä–æ—Å: –†–∞—Å—Å–∫–∞–∂–∏ –æ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
    ============================================================
    Load cache retriever
    –ù–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ **1–°: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–ª–¥–∏–Ω–≥–æ–º**, –∑–∞–∫–∞–∑–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø–æ–¥ 1–°, –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–µ –∏ –æ–±—É—á–µ–Ω–∏–∏. –ú—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –±–∏–∑–Ω–µ—Å–æ–≤, —Å–æ–∑–¥–∞—ë–º –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –∫–ª–∏–µ–Ω—Ç–∞–º —Ä–∞—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º.
    
    **–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã:**
    - **23 –≥–æ–¥–∞ –æ–ø—ã—Ç–∞** –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤.
    - **>300 –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤**.
    - **100+ –ø—Ä–æ–µ–∫—Ç–æ–≤** –¥–ª—è —Ö–æ–ª–¥–∏–Ω–≥–æ–≤ –∏ –æ—Ä–≥–∞–Ω–æ–≤ –≤–ª–∞—Å—Ç–∏.
    - 5 –æ—Ñ–∏—Å–æ–≤ (–ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç‚Äë–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ò–∂–µ–≤—Å–∫, –¢–∞–º–±–æ–≤, –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫).
    
    **–ú–∏—Å—Å–∏—è:** —Å–æ–∑–¥–∞–≤–∞—Ç—å —É–º–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏–∑–∞, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ö–æ–ª–¥–∏–Ω–≥–æ–º, –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–µ–π –∏–ª–∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π.
    –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ–∫:  2.3
    
    ============================================================
    –ó–∞–ø—Ä–æ—Å: –ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –õ–æ–Ω–¥–æ–Ω–µ?
    ============================================================
    –ü–æ–≥–æ–¥–∞ –≤ –õ–æ–Ω–¥–æ–Ω–µ —Å–µ–≥–æ–¥–Ω—è –æ–∂–∏–¥–∞–µ—Ç—Å—è +9‚Ä¶+8‚ÄØ¬∞C, –ª–∏–≤–Ω–µ–≤—ã–π –¥–æ–∂–¥—å –∏ —Å–ª–∞–±—ã–π –≤–µ—Ç–µ—Ä¬†‚Äì¬†[RP5](https://m.rp5.ru/–ü–æ–≥–æ–¥–∞_–≤_–õ–æ–Ω–¥–æ–Ω–µ,_–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è).
    –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ–∫:  3.1
    
    ============================================================
    –ó–∞–ø—Ä–æ—Å: –ì–¥–µ –∑–∞–∫–∞–∑ Order-345876?
    ============================================================
    –ó–∞–∫–∞–∑ **order‚Äë345876** –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—É—Ç–∏‚ÄØ‚Äî‚ÄØ–ú–æ—Å–∫–≤–∞, –æ–∂–∏–¥–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞–≤–∫–∞ 2026‚Äë12‚Äë10.
    –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ–∫:  0.8
    
    ============================================================
    –ó–∞–ø—Ä–æ—Å: –ü–æ—Å—á–∏—Ç–∞–π 20% –æ—Ç 7500
    ============================================================
    20‚ÄØ% –æ—Ç 7‚ÄØ500‚ÄØ‚Äî —ç—Ç–æ **1‚ÄØ500**.
    –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ–∫:  1.1
    
    ============================================================
    –ó–∞–ø—Ä–æ—Å: 100 EUR –≤ —Ä—É–±–ª—è—Ö
    ============================================================
    100‚ÄØEUR ‚âà **9‚ÄØ007‚ÄØ‚ÇΩ** (–ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –∫—É—Ä—Å—É).
    –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ–∫:  1.2
    
    ============================================================
    –ó–∞–ø—Ä–æ—Å: –°—Ä–∞–≤–Ω–∏ –≤–∞—à–∏ —Ü–µ–Ω—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏
    ============================================================
    Load cache retriever
    –ù–∞—à–∏ —Ü–µ–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ, —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º–æ–º —Å —Ü–µ–Ω–∞–º–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –Ω–∞ —Ä—ã–Ω–∫–µ 1–°‚Äë—Ä–µ—à–µ–Ω–∏–π. –ù–∏–∂–µ –∫—Ä–∞—Ç–∫–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤:
    
    | –ü—Ä–æ–¥—É–∫—Ç | –ù–∞—à–∞ —Ü–µ–Ω–∞ (–µ–¥.) | –¢–∏–ø–∏—á–Ω—ã–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω |
    |---------|-----------------|--------------------------------|
    | **–£–ø—Ä–æ—â–µ–Ω–∫–∞ 8** |‚ÄØ7‚ÄØ300‚ÄØ‚ÇΩ | 6‚ÄØ500‚Äì8‚ÄØ000‚ÄØ‚ÇΩ |
    | **–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å 8** |‚ÄØ7‚ÄØ300‚ÄØ‚ÇΩ | 6‚ÄØ800‚Äì8‚ÄØ200‚ÄØ‚ÇΩ |
    | **–ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–µ–π 8** |‚ÄØ9‚ÄØ100‚ÄØ‚ÇΩ | 8‚ÄØ500‚Äì10‚ÄØ000‚ÄØ‚ÇΩ |
    | **–ü–†–û–§. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π 8** |‚ÄØ34‚ÄØ800‚ÄØ‚ÇΩ | 33‚ÄØ000‚Äì36‚ÄØ000‚ÄØ‚ÇΩ |
    | **–ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—à–µ–π —Ñ–∏—Ä–º–æ–π 8** |‚ÄØ6‚ÄØ300‚ÄØ‚ÇΩ | 5‚ÄØ800‚Äì7‚ÄØ200‚ÄØ‚ÇΩ |
    | **–ü–†–û–§. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—à–µ–π —Ñ–∏—Ä–º–æ–π 8** |‚ÄØ26‚ÄØ800‚ÄØ‚ÇΩ | 25‚ÄØ000‚Äì28‚ÄØ500‚ÄØ‚ÇΩ |
    | **–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è 8 –ü–†–û–§ (5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)** |‚ÄØ39‚ÄØ900‚ÄØ‚ÇΩ | 38‚ÄØ000‚Äì41‚ÄØ000‚ÄØ‚ÇΩ |
    
    > *–ò—Å—Ç–æ—á–Ω–∏–∫: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ (RAG)*
    
    **–í—ã–≤–æ–¥:**  
    - –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –±–∞–∑–æ–≤—ã—Ö –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –Ω–∞—à–∏ —Ü–µ–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ä–µ–¥–Ω–∏—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ü–µ–Ω, –∏–Ω–æ–≥–¥–∞ —á—É—Ç—å –Ω–∏–∂–µ.  
    - –í —Å–µ–≥–º–µ–Ω—Ç–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è 8 –ö–û–†–ü¬ª) —Ü–µ–Ω–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–µ—Ä—Ö–Ω–∏–º –ø—Ä–µ–¥–µ–ª–æ–º —Ä—ã–Ω–∫–∞, –Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞.
    
    –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (—Å—Ä–æ–∫–∏ –ø–æ—Å—Ç–∞–≤–∫–∏, —Å–µ—Ä–≤–∏—Å), –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å!
    –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ–∫:  4.0
    
    === –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ===
    
    ============================================================
    üìä –ú–ï–¢–†–ò–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
    ============================================================
    üìà –û–°–ù–û–í–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò:
      –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤     :         13
      –£—Å–ø–µ—à–Ω—ã—Ö           :         13
      –° –æ—à–∏–±–∫–∞–º–∏         :          0
    
    üî§ –¢–û–ö–ï–ù–´:
      –í—Ö–æ–¥–Ω—ã–µ            :     11,533
      –í—ã—Ö–æ–¥–Ω—ã–µ           :      1,087
    
    üí∞ –°–¢–û–ò–ú–û–°–¢–¨:
      USD                :     0.0253$
      RUB                :       2.02‚ÇΩ
    
    ‚è±Ô∏è  –í–†–ï–ú–Ø –û–¢–í–ï–¢–ê (—Å–µ–∫):
      –ú–µ–¥–∏–∞–Ω–∞ (p50)      :      0.405
      95-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å    :      3.692
      99-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å    :      3.692
    
    ============================================================"""