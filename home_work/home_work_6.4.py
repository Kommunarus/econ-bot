from typing import TypedDict, List, Optional
import asyncio
import time

from langgraph.graph import StateGraph, MessagesState, END, START
import os
from dotenv import load_dotenv
from langchain_core.messages import HumanMessage
from langchain_core.documents import Document
from langchain_core.prompts import ChatPromptTemplate
from langchain_huggingface import HuggingFaceEmbeddings
from langchain_community.vectorstores import FAISS
from langchain_openai import ChatOpenAI
from ddgs import DDGS

load_dotenv('my.env')
MODEL = os.getenv("MODEL")
API_KEY = os.getenv("API_KEY")
API_BASE = os.getenv("API_BASE")

chat_model = ChatOpenAI(model_name=MODEL, openai_api_key=API_KEY, openai_api_base=API_BASE)


class QueryState(TypedDict):
    query: str
    rag_docs: Optional[List[str]]
    web_docs: Optional[List[str]]
    merged_docs: Optional[List[str]]
    answer: Optional[str]


# –ø–æ –¥–∞–Ω–Ω—ã–º –≤–∏–∫–∏–ø–µ–¥–∏–∏ https://ru.wikipedia.org/wiki/%D0%9A%D0%BB%D0%B8%D0%BC%D0%B0%D1%82_%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D1%8B
docs = [
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 8.6"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 8.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 19.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 28.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 33.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 34.8"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 38.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 37.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 32.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 24"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 16.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –ê–±—Å–æ–ª—é–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 9.6"),

        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: -3.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: -3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 11.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 19.0"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 22.4"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 24.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 22.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 16.4"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 8.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: 1.6"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∞–∫—Å–∏–º—É–º, ¬∞C: -2.3"),

        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: -6.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: -5.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: -0.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: 6.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: 13.6"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: 17.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: 19.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: 17.6"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: 11.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: 5.8"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: -0.5"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞C: -4.4"),

        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -8.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -8.8"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -4.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 2.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 8.1"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 12.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 14.8"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 13.0"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 8.0"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 3.0"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -2.4"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –°—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -6.5"),

        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -42.1"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -38.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -32.4"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -21"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -7.5"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -2.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: 1.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -1.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -8.5"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -20.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -32.8"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º, ¬∞C: -38.8"),

        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 53"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 44"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 39"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 37"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 61"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 78"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 84"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 78"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 66"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 70"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 52"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –ù–æ—Ä–º–∞ –æ—Å–∞–¥–∫–æ–≤, –º–º: 51"),

        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 21.4"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 17.6"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 12.2"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 12.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 14.1"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 12.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 14.8"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 11.7"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 11.9"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 15.3"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 15.1"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π —Å –æ—Å–∞–¥–∫–∞–º–∏: 21.1"),

        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –Ø–Ω–≤–∞—Ä—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 37"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –§–µ–≤—Ä–∞–ª—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 65"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞—Ä—Ç. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 142"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–ø—Ä–µ–ª—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 213"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ú–∞–π. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 274"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–Ω—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 299"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ò—é–ª—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 323"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ê–≤–≥—É—Å—Ç. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 242"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –°–µ–Ω—Ç—è–±—Ä—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 171"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –û–∫—Ç—è–±—Ä—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 89"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –ù–æ—è–±—Ä—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 33"),
        Document(page_content="–ü–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤—ã. –î–µ–∫–∞–±—Ä—å. –°–æ–ª–Ω–µ—á–Ω–æ–µ —Å–∏—è–Ω–∏–µ, —á: 14"),
    ]
embeddings = HuggingFaceEmbeddings(model_name='intfloat/multilingual-e5-base')
vectorstore = FAISS.from_documents(docs, embeddings)


def query_prep(state: QueryState) -> dict:
    """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞"""
    return {}

async def rag2(q):
    rag_doc =  vectorstore.similarity_search(q)
    doc = [d.page_content for d in rag_doc]
    return doc

async def rag_search(state: QueryState) -> dict:
    """–ü–æ–∏—Å–∫ –≤ RAG‚Äë–±–∞–∑–µ"""
    print(f"[{time.strftime('%H:%M:%S')}] üîç rag_search: –ù–∞—á–∞—Ç –ø–æ–∏—Å–∫ –≤ RAG –±–∞–∑–µ...")
    query = state['query']
    await asyncio.sleep(2)
    result = await rag2(query)
    print(f"[{time.strftime('%H:%M:%S')}] ‚úÖ rag_search: –ù–∞–π–¥–µ–Ω–æ {len(result)} –¥–æ–∫—É–º–µ–Ω—Ç–∞")
    return {"rag_docs": result}


async def web_search2(q, k):
    ddgs = DDGS()
    results = []
    query = q
    search = ddgs.text(query, max_results=k, timelimit="y")
    for i, r in enumerate(search):
        title = r.get("title")
        snippet = r.get("body") or r.get("Text") or ""
        url = r.get("href")
        results.append(f"{i + 1}. {title}: {snippet} [source: {url}]")
    return results

async def web_search(state: QueryState, k: int = 5) -> dict:
    """–í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ–±-–ø–æ–∏—Å–∫. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç top-k —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    query - –≤–æ–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –ø–æ–∏—Å–∫–æ–≤–∏–∫–µ.
    k - —Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫ –Ω—É–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ –∑–∞–ø—Ä–æ—Å—É query"""
    print(f"[{time.strftime('%H:%M:%S')}] üåê web_search: –ù–∞—á–∞—Ç –≤–µ–± –ø–æ–∏—Å–∫...")
    query = state['query']
    try:
        results = await asyncio.wait_for(
            web_search2(query, k),
            timeout=6
        )
    except asyncio.TimeoutError:
        results = []

    print(f"[{time.strftime('%H:%M:%S')}] ‚úÖ web_search: –ù–∞–π–¥–µ–Ω–æ {len(results)} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")

    return {"web_docs": results}


def merge(state: QueryState) -> dict:
    """–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""

    internal = state.get("rag_docs") or []
    external = state.get("web_docs") or []
    combined = []
    seen = set()
    for doc in internal:
        if doc not in seen:
            combined.append(doc)
            seen.add(doc)
    for doc in external:
        if doc not in seen:
            combined.append(doc)
            seen.add(doc)

    if not combined:
        return {"answer": "–ò–∑–≤–∏–Ω–∏—Ç–µ, –º–Ω–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É."}

    combined = combined[:6]
    return {"merged_docs": combined}


def answer(state: QueryState) -> dict:
    """–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞"""
    context = " | ".join(state["merged_docs"])
    query = state["query"]
    chat_prompt = ChatPromptTemplate.from_template(
        """–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∞.
        –¢–≤–æ—è –∑–∞–¥–∞—á–∞ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –¥–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ –ø–æ–≥–æ–¥—É. 
        –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã –æ—Ç —Å–µ–±—è. 
        –ï—Å–ª–∏ –≤ rag –Ω–∞–π–¥–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç, —Ä–µ–ª–µ–≤–∞–Ω—Ç—ã–π –≤–æ–ø—Ä–æ—Å—É - –¥–∞–π –≤ —Å–≤–æ–µ–º –æ—Ç–≤–µ—Ç–µ —ç—Ç–∏–º –¥–∞–Ω–Ω—ã–º –±–û–ª—å—à–∏–π –≤–µ—Å.
        –ï—Å–ª–∏ –≤ rag –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞, –±–û–ª—å—à–∏–π –≤–µ—Å –¥–∞–π –¥–∞–Ω–Ω—ã–º —Å web. 
        –í–æ–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: \n{query}\n
        –ö–æ–Ω—Ç–µ–∫—Å—Ç: \n{context}\n
        –û—Ç–≤–µ—Ç:
    """
    )
    prompt = chat_prompt.invoke({"context": context, "query": query})
    result = chat_model.invoke(prompt)
    #

    return {"answer": result.content}



# –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞
graph = StateGraph(QueryState)

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤
graph.add_node("query_prep", query_prep)
graph.add_node("rag_search", rag_search)
graph.add_node("web_search", web_search)
graph.add_node("merge", merge)
graph.add_node("answer", answer)

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä—ë–±–µ—Ä
graph.add_edge(START, "query_prep")

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
graph.add_edge("query_prep", "rag_search")
graph.add_edge("query_prep", "web_search")

# –°—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ merge
graph.add_edge("rag_search", "merge")
graph.add_edge("web_search", "merge")

# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
graph.add_edge("merge", "answer")
graph.add_edge("answer", END)

app = graph.compile()

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞"""
    while True:
        user_input = input("üë§ –í—ã: ").strip()

        if user_input.lower() in ['exit', 'quit', '–≤—ã—Ö–æ–¥']:
            print("\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
            break

        if not user_input:
            continue

        result = await app.ainvoke({
            "query": user_input,
            "rag_docs": None,
            "web_docs": None,
            "merged_docs": None,
            "answer": None
        })

        answer = result["answer"]
        print(f"\nü§ñ –ê–≥–µ–Ω—Ç: {answer}\n")



asyncio.run(main())


"""üë§ –í—ã: –æ–ø–∏—à–∏ –ø–æ–≥–æ–¥—É –≤ –û—Å–ª–æ –≤ 2025 –≥–æ–¥—É.
[13:59:35] üîç rag_search: –ù–∞—á–∞—Ç –ø–æ–∏—Å–∫ –≤ RAG –±–∞–∑–µ...
[13:59:35] ‚úÖ rag_search: –ù–∞–π–¥–µ–Ω–æ 4 –¥–æ–∫—É–º–µ–Ω—Ç–∞
[13:59:35] üåê web_search: –ù–∞—á–∞—Ç –≤–µ–± –ø–æ–∏—Å–∫...
[13:59:36] ‚úÖ web_search: –ù–∞–π–¥–µ–Ω–æ 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

ü§ñ –ê–≥–µ–Ω—Ç: **–ü–æ–≥–æ–¥–∞ –≤ –û—Å–ª–æ (–æ–±—â–∏–π –æ–±–∑–æ—Ä –ø–æ –º–µ—Å—è—Ü–∞–º)**  

–°–æ–≥–ª–∞—Å–Ω–æ –¥–∞–Ω–Ω—ã–º –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (vc.ru –∏ Yandex –ü–æ–≥–æ–¥–∞), –∫–ª–∏–º–∞—Ç –û—Å–ª–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è —É–º–µ—Ä–µ–Ω–Ω–æ —Ö–æ–ª–æ–¥–Ω—ã–º–∏ –∑–∏–º–∞–º–∏ –∏ –ø—Ä–æ—Ö–ª–∞–¥–Ω—ã–º –ª–µ—Ç–æ–º, —Å –¥–æ–≤–æ–ª—å–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –æ—Å–∞–¥–∫–æ–≤–æ—Å—Ç—å—é –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≥–æ–¥–∞. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:

| –ú–µ—Å—è—Ü | –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–Ω—ë–º (¬∞C) | –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–æ—á—å—é (¬∞C) | –û–∂–∏–¥–∞–µ–º–∞—è –æ—Å–∞–¥–∫–∏ (–º–º) |
|-------|------------------------------|--------------------------------|------------------------|
| –Ø–Ω–≤–∞—Ä—å | ‚Äì2‚Ä¶0 | ‚Äì6‚Ä¶‚Äì4 | 30‚Äë40 |
| –§–µ–≤—Ä–∞–ª—å | ‚Äì1‚Ä¶1 | ‚Äì5‚Ä¶‚Äì3 | 25‚Äë35 |
| –ú–∞—Ä—Ç | 2‚Ä¶4 | ‚Äì2‚Ä¶0 | 20‚Äë30 |
| –ê–ø—Ä–µ–ª—å | 7‚Ä¶9 | 2‚Ä¶4 | 15‚Äë25 |
| –ú–∞–π | 12‚Ä¶14 | 6‚Ä¶8 | 10‚Äë20 |
| –ò—é–Ω—å | 16‚Ä¶18 | 10‚Ä¶12 | 5‚Äë15 |
| –ò—é–ª—å | 17‚Ä¶19 | 11‚Ä¶13 | 5‚Äë15 |
| –ê–≤–≥—É—Å—Ç | 15‚Ä¶17 | 9‚Ä¶11 | 10‚Äë20 |
| –°–µ–Ω—Ç—è–±—Ä—å | 10‚Ä¶12 | 5‚Ä¶7 | 15‚Äë25 |
| –û–∫—Ç—è–±—Ä—å | 6‚Ä¶8 | 1‚Ä¶3 | 20‚Äë30 |
| –ù–æ—è–±—Ä—å | 2‚Ä¶4 | ‚Äì1‚Ä¶1 | 25‚Äë35 |
| –î–µ–∫–∞–±—Ä—å | ‚Äì1‚Ä¶1 | ‚Äì5‚Ä¶‚Äì3 | 30‚Äë40 |

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–û—Å–∞–¥–∫–∏** —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ—á—Ç–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ, –Ω–æ –≤ –∑–∏–º–Ω–∏–µ –º–µ—Å—è—Ü—ã (–¥–µ–∫–∞–±—Ä—å‚Äë—è–Ω–≤–∞—Ä—å) –æ–Ω–∏ –±—ã–≤–∞—é—Ç –±–æ–ª–µ–µ —á–∞—Å—Ç—ã–º–∏ –∏ —Å–Ω–µ–∂–Ω—ã–º–∏.
- **–°–æ–ª–Ω—Ü–µ**: –í –ª–µ—Ç–Ω–∏–π –ø–µ—Ä–∏–æ–¥ (–∏—é–Ω—å‚Äì–∞–≤–≥—É—Å—Ç) –º–æ–∂–Ω–æ –æ–∂–∏–¥–∞—Ç—å –æ–∫–æ–ª–æ 10‚Äì12 —á–∞—Å–æ–≤ –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–≤–µ—Ç–∞, –∞ –∑–∏–º–æ–π ‚Äì —Ç–æ–ª—å–∫–æ 4‚Äì5 —á–∞—Å–æ–≤.  
- **–í–ª–∞–∂–Ω–æ—Å—Ç—å** –æ–±—ã—á–Ω–æ –¥–µ—Ä–∂–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 60‚Äë70‚ÄØ%, –Ω–æ –º–æ–∂–µ—Ç –ø–æ–≤—ã—à–∞—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –æ—Å–∞–¥–∫–æ–≤.

> *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Ö –∏ —Ç–∏–ø–∏—á–Ω—ã—Ö –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–µ–Ω–¥–∞—Ö –¥–ª—è –û—Å–ª–æ; –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∑–∞ 2025 –≥–æ–¥ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –∏–∑‚Äë–∑–∞ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã—Ö –º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∞–Ω–æ–º–∞–ª–∏–π.  

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –≤ –∏—é–ª–µ‚ÄØ2025), —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–º—É –ø—Ä–æ–≥–æ–Ω—É –æ—Ç Yandex –ü–æ–≥–æ–¥–∞ –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –±–ª–∏–∂–µ –∫ –Ω—É–∂–Ω–æ–π –¥–∞—Ç–µ.
"""



""" –í—ã: —Å—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –º–æ—Å–∫–≤–µ –ø–æ –º–µ—Å—è—Ü–∞–º
[14:01:40] üîç rag_search: –ù–∞—á–∞—Ç –ø–æ–∏—Å–∫ –≤ RAG –±–∞–∑–µ...
[14:01:40] üåê web_search: –ù–∞—á–∞—Ç –≤–µ–± –ø–æ–∏—Å–∫...
[14:01:42] ‚úÖ web_search: –ù–∞–π–¥–µ–Ω–æ 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
[14:01:42] ‚úÖ rag_search: –ù–∞–π–¥–µ–Ω–æ 4 –¥–æ–∫—É–º–µ–Ω—Ç–∞

ü§ñ –ê–≥–µ–Ω—Ç: **–°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –ú–æ—Å–∫–≤–µ –ø–æ –º–µ—Å—è—Ü–∞–º (–Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)**  

| –ú–µ—Å—è—Ü | –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, ¬∞C* |
|-------|----------------------|
| –Ø–Ω–≤–∞—Ä—å | -42,1‚ÄØ¬∞C (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∏–Ω–∏–º—É–º) ‚Äì –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞; —Ç–æ—á–Ω–∞—è —Å—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞. |
| –ú–∞–π | 8,1‚ÄØ¬∞C (—Å—Ä–µ–¥–Ω–∏–π —Å—É—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏–º—É–º) ‚Äì –¥–∞–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. |

*–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏. –ü–æ–ª–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–µ–¥–Ω–∏—Ö —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è –ú–æ—Å–∫–≤—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –ø–æ—ç—Ç–æ–º—É –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Å—è—Ü—ã –Ω–µ–ª—å–∑—è —É—Ç–æ—á–Ω–∏—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º —Ä–µ—Å—É—Ä—Å–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–π—Ç ¬´–ü–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ¬ª –æ—Ç –Ø–Ω–¥–µ–∫—Å).
"""